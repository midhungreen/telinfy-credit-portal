<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telinfy Credit Portal</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%236366f1'/><text x='50%25' y='55%25' dominant-baseline='middle' text-anchor='middle' fill='white' font-size='18' font-weight='bold'>T</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', 'Segoe UI', sans-serif; background: #f4f6fa; }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px) } to { opacity: 1; transform: translateY(0) } }
    @keyframes toastIn { from { opacity: 0; transform: translateY(-12px) } to { opacity: 1; transform: translateY(0) } }
    @keyframes pulse { 0%,100%{opacity:.5} 50%{opacity:1} }
    ::-webkit-scrollbar { width: 6px }
    ::-webkit-scrollbar-track { background: transparent }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px }
    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <!-- React -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>

  <script>
    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘  ğŸ”§ FIREBASE CONFIG â€” PASTE YOUR CONFIG HERE                â•‘
    // â•‘  Get it from: Firebase Console â†’ Project Settings â†’ Web App â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // â”€â”€â”€ Initialize Firebase â”€â”€â”€
    let db = null;
    let firebaseReady = false;
    try {
      if (firebaseConfig.apiKey !== "YOUR_API_KEY") {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
        firebaseReady = true;
      }
    } catch (e) {
      console.error("Firebase init error:", e);
    }
  </script>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // â”€â”€â”€ CONSTANTS â”€â”€â”€
    const PLATFORMS = [
      { id: "a_sap", name: "a.sapteleservices.in", system: "credit" },
      { id: "b_sap", name: "b.sapteleservices.in", system: "credit" },
      { id: "one_telinfy", name: "one.telinfy.com", system: "wallet" },
      { id: "hub_telinfy", name: "hub.telinfy.com", system: "wallet" },
      { id: "rcs_telinfy", name: "Rcs.telinfy.com", system: "credit" },
    ];

    const STATUS = {
      PENDING_ACCOUNTS: "Pending Accounts",
      APPROVED: "Approved",
      REJECTED: "Rejected",
      COMPLETED: "Completed",
      AUTO_APPROVED: "Auto-Approved",
    };

    const STATUS_COLORS = {
      [STATUS.PENDING_ACCOUNTS]: { bg: "#FFF3E0", text: "#E65100", border: "#FFB74D" },
      [STATUS.APPROVED]: { bg: "#E8F5E9", text: "#1B5E20", border: "#81C784" },
      [STATUS.AUTO_APPROVED]: { bg: "#E0F2F1", text: "#004D40", border: "#4DB6AC" },
      [STATUS.REJECTED]: { bg: "#FFEBEE", text: "#B71C1C", border: "#E57373" },
      [STATUS.COMPLETED]: { bg: "#E3F2FD", text: "#0D47A1", border: "#64B5F6" },
    };

    const ROLES = [
      { id: "sales", label: "Sales", icon: "ğŸ“Š", color: "#6366f1" },
      { id: "accounts", label: "Accounts", icon: "ğŸ“‹", color: "#f59e0b" },
      { id: "ops", label: "Operations", icon: "âš™ï¸", color: "#3b82f6" },
      { id: "admin", label: "Admin", icon: "ğŸ”’", color: "#dc2626" },
    ];

    const DEFAULT_ADMIN = { id: "admin_default", username: "telinfy", password: "Tel@2025!", fullName: "Telinfy Admin", role: "admin", active: true, createdAt: new Date().toISOString() };

    const generateId = () => `REQ-${Date.now().toString(36).toUpperCase()}`;
    const generateUserId = () => `USR-${Date.now().toString(36).toUpperCase()}`;
    const formatDate = (d) => new Date(d).toLocaleDateString("en-IN", { day: "2-digit", month: "short", year: "numeric", hour: "2-digit", minute: "2-digit" });
    const getRoleColor = (r) => ROLES.find(x => x.id === r)?.color || "#6366f1";
    const getRoleInfo = (r) => ROLES.find(x => x.id === r) || ROLES[0];

    // â”€â”€â”€ Firebase Realtime Hook (shared data) â”€â”€â”€
    function useFirebase(path, initial) {
      const [data, setData] = useState(initial);
      const [loaded, setLoaded] = useState(!firebaseReady);

      useEffect(() => {
        if (!firebaseReady || !db) { setLoaded(true); return; }
        const ref = db.ref(path);
        const handler = ref.on('value', (snap) => {
          const val = snap.val();
          if (Array.isArray(initial)) {
            setData(val ? (Array.isArray(val) ? val : Object.values(val)).filter(Boolean) : []);
          } else {
            setData(val !== null ? val : initial);
          }
          setLoaded(true);
        }, (err) => { console.error("DB read error:", err); setLoaded(true); });
        return () => ref.off('value', handler);
      }, [path]);

      const save = useCallback((val) => {
        setData(val);
        if (firebaseReady && db) { db.ref(path).set(val).catch(e => console.error("DB write error:", e)); }
      }, [path]);

      return [data, save, loaded];
    }

    // â”€â”€â”€ Local Storage Hook (session only â€” per device) â”€â”€â”€
    function useLocal(key, initial) {
      const [data, setData] = useState(() => {
        try { const v = localStorage.getItem(key); return v ? JSON.parse(v) : initial; } catch { return initial; }
      });
      const save = useCallback((val) => {
        setData(val);
        try { if (val === null) localStorage.removeItem(key); else localStorage.setItem(key, JSON.stringify(val)); } catch {}
      }, [key]);
      return [data, save];
    }

    // â”€â”€â”€ Shared Styles â”€â”€â”€
    const inputStyle = {
      width: "100%", padding: "12px 14px", border: "1.5px solid #e2e8f0", borderRadius: 10,
      fontSize: 14, outline: "none", transition: "border 0.2s, box-shadow 0.2s", fontFamily: "inherit",
      background: "#fafbfc", boxSizing: "border-box",
    };
    const labelStyle = { display: "block", fontSize: 12, fontWeight: 600, color: "#475569", marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.6 };
    const focusHandler = (color = "#6366f1") => ({
      onFocus: e => { e.target.style.borderColor = color; e.target.style.boxShadow = `0 0 0 3px ${color}18`; },
      onBlur: e => { e.target.style.borderColor = "#e2e8f0"; e.target.style.boxShadow = "none"; },
    });

    // â”€â”€â”€ Badge â”€â”€â”€
    function Badge({ status }) {
      const c = STATUS_COLORS[status] || { bg: "#F5F5F5", text: "#333", border: "#CCC" };
      return <span style={{ display: "inline-block", padding: "4px 12px", borderRadius: 20, fontSize: 12, fontWeight: 600, background: c.bg, color: c.text, border: `1px solid ${c.border}`, letterSpacing: 0.3, whiteSpace: "nowrap" }}>{status}</span>;
    }

    // â”€â”€â”€ Modal â”€â”€â”€
    function Modal({ open, onClose, title, children, width }) {
      if (!open) return null;
      return (
        <div style={{ position: "fixed", inset: 0, background: "rgba(15,23,42,0.45)", backdropFilter: "blur(6px)", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1000, animation: "fadeIn 0.2s ease" }} onClick={onClose}>
          <div onClick={e => e.stopPropagation()} style={{ background: "#fff", borderRadius: 16, padding: "32px 36px", minWidth: width || 420, maxWidth: width || 540, boxShadow: "0 25px 60px rgba(0,0,0,0.15)", animation: "slideUp 0.25s ease", maxHeight: "85vh", overflowY: "auto" }}>
            <h3 style={{ margin: "0 0 20px", fontSize: 20, fontWeight: 700, color: "#1a1a2e" }}>{title}</h3>
            {children}
          </div>
        </div>
      );
    }

    function EmptyState({ icon, message }) {
      return <div style={{ textAlign: "center", padding: "60px 20px", color: "#94a3b8" }}><div style={{ fontSize: 48, marginBottom: 12 }}>{icon}</div><p style={{ fontSize: 15, margin: 0, lineHeight: 1.6 }}>{message}</p></div>;
    }

    function StatCard({ label, value, color, icon }) {
      return (
        <div style={{ background: "#fff", borderRadius: 14, padding: "20px 22px", border: "1px solid #e8ecf1", display: "flex", alignItems: "center", gap: 16, minWidth: 0 }}>
          <div style={{ width: 44, height: 44, borderRadius: 12, background: color + "18", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 20, flexShrink: 0 }}>{icon}</div>
          <div style={{ minWidth: 0 }}>
            <div style={{ fontSize: 24, fontWeight: 800, color: "#1a1a2e", lineHeight: 1 }}>{value}</div>
            <div style={{ fontSize: 12, color: "#94a3b8", fontWeight: 500, marginTop: 4, textTransform: "uppercase", letterSpacing: 0.5 }}>{label}</div>
          </div>
        </div>
      );
    }

    function FilterTabs({ filters, active, onChange }) {
      return (
        <div style={{ display: "flex", gap: 6, flexWrap: "wrap", marginBottom: 20 }}>
          {filters.map(f => (
            <button key={f.value} onClick={() => onChange(f.value)} style={{
              padding: "8px 16px", borderRadius: 20, border: active === f.value ? "1.5px solid #6366f1" : "1.5px solid #e2e8f0",
              background: active === f.value ? "#eef2ff" : "#fff", color: active === f.value ? "#4338ca" : "#64748b",
              fontSize: 13, fontWeight: 600, cursor: "pointer", fontFamily: "inherit", transition: "all 0.2s",
            }}>{f.label} {f.count > 0 && <span style={{ marginLeft: 4, background: active === f.value ? "#6366f1" : "#e2e8f0", color: active === f.value ? "#fff" : "#64748b", padding: "1px 7px", borderRadius: 10, fontSize: 11 }}>{f.count}</span>}</button>
          ))}
        </div>
      );
    }

    // â”€â”€â”€ Connection Status â”€â”€â”€
    function ConnectionDot() {
      const [online, setOnline] = useState(firebaseReady);
      useEffect(() => {
        if (!firebaseReady || !db) return;
        const ref = db.ref('.info/connected');
        ref.on('value', (snap) => setOnline(snap.val() === true));
        return () => ref.off();
      }, []);
      if (!firebaseReady) return <span title="Firebase not configured â€” using local mode" style={{ width: 8, height: 8, borderRadius: 4, background: "#f59e0b", display: "inline-block", animation: "pulse 2s infinite" }} />;
      return <span title={online ? "Connected â€” live sync active" : "Reconnecting..."} style={{ width: 8, height: 8, borderRadius: 4, background: online ? "#10b981" : "#ef4444", display: "inline-block" }} />;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â”€â”€â”€ SETUP SCREEN (shown when Firebase not configured) â”€â”€â”€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function SetupBanner() {
      if (firebaseReady) return null;
      return (
        <div style={{ background: "linear-gradient(135deg, #fef3c7, #fde68a)", border: "1px solid #f59e0b", borderRadius: 12, padding: "16px 20px", marginBottom: 24, display: "flex", alignItems: "flex-start", gap: 12 }}>
          <span style={{ fontSize: 20, flexShrink: 0 }}>âš ï¸</span>
          <div>
            <div style={{ fontWeight: 700, color: "#92400e", fontSize: 14, marginBottom: 4 }}>Running in Local Mode â€” Firebase not configured</div>
            <div style={{ fontSize: 13, color: "#a16207", lineHeight: 1.5 }}>
              Data is saved only in this browser. To enable shared live data across all team devices, add your Firebase config to the HTML file.
              <br />Open the file in a text editor â†’ find <code style={{ background: "#fff7ed", padding: "1px 4px", borderRadius: 3 }}>YOUR_API_KEY</code> â†’ replace with your Firebase project config.
            </div>
          </div>
        </div>
      );
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â”€â”€â”€ LOGIN SCREEN â”€â”€â”€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function LoginScreen({ users, onLogin }) {
      const [username, setUsername] = useState("");
      const [password, setPassword] = useState("");
      const [error, setError] = useState("");
      const [showPwd, setShowPwd] = useState(false);

      const handleLogin = () => {
        setError("");
        if (!username.trim() || !password) { setError("Please enter both username and password."); return; }
        const allUsers = [DEFAULT_ADMIN, ...users];
        const found = allUsers.find(u => u.username.toLowerCase() === username.trim().toLowerCase() && u.password === password && u.active !== false);
        if (!found) { setError("Invalid credentials or account is deactivated."); return; }
        onLogin(found);
      };

      return (
        <div style={{ minHeight: "100vh", background: "linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%)", display: "flex", alignItems: "center", justifyContent: "center" }}>
          <div style={{ width: 420, animation: "slideUp 0.4s ease" }}>
            <div style={{ textAlign: "center", marginBottom: 36 }}>
              <div style={{ width: 64, height: 64, borderRadius: 20, background: "linear-gradient(135deg, #6366f1, #7c3aed)", display: "inline-flex", alignItems: "center", justifyContent: "center", color: "#fff", fontSize: 28, fontWeight: 800, marginBottom: 18, boxShadow: "0 8px 32px rgba(99,102,241,0.35)" }}>T</div>
              <h1 style={{ margin: "0 0 6px", fontSize: 28, fontWeight: 800, color: "#f1f5f9", letterSpacing: -0.5 }}>Telinfy Credit Portal</h1>
              <p style={{ margin: 0, fontSize: 14, color: "#64748b" }}>Sign in with your credentials</p>
            </div>
            <div style={{ background: "#fff", borderRadius: 20, padding: "36px 40px", boxShadow: "0 20px 60px rgba(0,0,0,0.3)" }}>
              {error && <div style={{ padding: "10px 14px", borderRadius: 10, background: "#fef2f2", border: "1px solid #fecaca", color: "#dc2626", fontSize: 13, fontWeight: 500, marginBottom: 18, display: "flex", alignItems: "center", gap: 8 }}>âš  {error}</div>}
              <div style={{ marginBottom: 18 }}>
                <label style={labelStyle}>Username</label>
                <input value={username} onChange={e => { setUsername(e.target.value); setError(""); }} placeholder="Enter username" style={inputStyle} {...focusHandler()} onKeyDown={e => { if (e.key === "Enter") handleLogin(); }} />
              </div>
              <div style={{ marginBottom: 24 }}>
                <label style={labelStyle}>Password</label>
                <div style={{ position: "relative" }}>
                  <input value={password} onChange={e => { setPassword(e.target.value); setError(""); }} type={showPwd ? "text" : "password"} placeholder="Enter password" style={{ ...inputStyle, paddingRight: 44 }} {...focusHandler()} onKeyDown={e => { if (e.key === "Enter") handleLogin(); }} />
                  <button onClick={() => setShowPwd(!showPwd)} style={{ position: "absolute", right: 10, top: "50%", transform: "translateY(-50%)", border: "none", background: "none", cursor: "pointer", fontSize: 16, color: "#94a3b8", padding: 4 }}>{showPwd ? "ğŸ™ˆ" : "ğŸ‘"}</button>
                </div>
              </div>
              <button onClick={handleLogin} style={{ width: "100%", padding: "14px", borderRadius: 12, border: "none", background: "linear-gradient(135deg, #6366f1, #7c3aed)", color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", fontFamily: "inherit", boxShadow: "0 4px 16px rgba(99,102,241,0.3)" }}>Sign In</button>

            </div>
          </div>
        </div>
      );
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â”€â”€â”€ ADMIN PANEL â”€â”€â”€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function AdminPanel({ users, onSaveUsers }) {
      const [showCreate, setShowCreate] = useState(false);
      const [showEdit, setShowEdit] = useState(null);
      const [showPwd, setShowPwd] = useState({});
      const [form, setForm] = useState({ fullName: "", username: "", password: "", role: "", active: true });
      const [editForm, setEditForm] = useState({});
      const [error, setError] = useState("");
      const [search, setSearch] = useState("");

      const resetForm = () => { setForm({ fullName: "", username: "", password: "", role: "", active: true }); setError(""); };

      const handleCreate = () => {
        setError("");
        if (!form.fullName.trim() || !form.username.trim() || !form.password || !form.role) { setError("All fields are required."); return; }
        if (form.username.toLowerCase() === "admin") { setError("Username 'admin' is reserved."); return; }
        if (users.some(u => u.username.toLowerCase() === form.username.trim().toLowerCase())) { setError("Username already exists."); return; }
        if (form.password.length < 4) { setError("Password must be at least 4 characters."); return; }
        const newUser = { id: generateUserId(), ...form, fullName: form.fullName.trim(), username: form.username.trim(), createdAt: new Date().toISOString() };
        onSaveUsers([...users, newUser]);
        resetForm(); setShowCreate(false);
      };

      const handleEdit = () => {
        setError("");
        if (!editForm.fullName?.trim() || !editForm.role) { setError("Name and role are required."); return; }
        if (editForm.password && editForm.password.length < 4) { setError("Password must be at least 4 characters."); return; }
        const updated = users.map(u => {
          if (u.id !== showEdit) return u;
          const changes = { ...u, fullName: editForm.fullName.trim(), role: editForm.role, active: editForm.active };
          if (editForm.password) changes.password = editForm.password;
          return changes;
        });
        onSaveUsers(updated); setShowEdit(null); setError("");
      };

      const toggleActive = (userId) => onSaveUsers(users.map(u => u.id === userId ? { ...u, active: !u.active } : u));
      const deleteUser = (userId) => onSaveUsers(users.filter(u => u.id !== userId));

      const filtered = users.filter(u => u.fullName.toLowerCase().includes(search.toLowerCase()) || u.username.toLowerCase().includes(search.toLowerCase()) || u.role.toLowerCase().includes(search.toLowerCase()));
      const rc = { sales: users.filter(u => u.role === "sales").length, accounts: users.filter(u => u.role === "accounts").length, ops: users.filter(u => u.role === "ops").length };

      const RoleSelector = ({ value, onChange }) => (
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }}>
          {ROLES.map(r => (
            <button key={r.id} onClick={() => onChange(r.id)} style={{ padding: "12px 14px", borderRadius: 10, border: value === r.id ? `2px solid ${r.color}` : "1.5px solid #e2e8f0", background: value === r.id ? r.color + "10" : "#fafbfc", color: value === r.id ? r.color : "#64748b", cursor: "pointer", fontSize: 13, fontWeight: 600, fontFamily: "inherit", transition: "all 0.2s", display: "flex", alignItems: "center", gap: 8 }}><span>{r.icon}</span> {r.label}</button>
          ))}
        </div>
      );

      return (
        <div>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(170px, 1fr))", gap: 14, marginBottom: 28 }}>
            <StatCard label="Total Users" value={users.length} color="#6366f1" icon="ğŸ‘¥" />
            <StatCard label="Sales" value={rc.sales} color="#6366f1" icon="ğŸ“Š" />
            <StatCard label="Accounts" value={rc.accounts} color="#f59e0b" icon="ğŸ“‹" />
            <StatCard label="Operations" value={rc.ops} color="#3b82f6" icon="âš™ï¸" />
          </div>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 20, flexWrap: "wrap", gap: 12 }}>
            <input value={search} onChange={e => setSearch(e.target.value)} placeholder="Search users..." style={{ ...inputStyle, width: 300, background: "#fff" }} {...focusHandler()} />
            <button onClick={() => { resetForm(); setShowCreate(true); }} style={{ padding: "11px 24px", borderRadius: 12, border: "none", background: "linear-gradient(135deg, #6366f1, #7c3aed)", color: "#fff", fontSize: 14, fontWeight: 700, cursor: "pointer", fontFamily: "inherit", display: "flex", alignItems: "center", gap: 8, boxShadow: "0 4px 12px rgba(99,102,241,0.25)" }}>+ Create User</button>
          </div>
          <div style={{ background: "#fff", borderRadius: 16, border: "1px solid #e8ecf1", overflow: "hidden" }}>
            <div style={{ display: "grid", gridTemplateColumns: "2fr 1.5fr 1fr 1fr 1fr 1.2fr", padding: "14px 24px", background: "#f8fafc", borderBottom: "1px solid #e8ecf1", fontSize: 11, fontWeight: 700, color: "#94a3b8", textTransform: "uppercase", letterSpacing: 0.8 }}>
              <span>Full Name</span><span>Username</span><span>Password</span><span>Role</span><span>Status</span><span style={{ textAlign: "right" }}>Actions</span>
            </div>
            {filtered.length === 0 ? <EmptyState icon="ğŸ‘¤" message="No users found. Create your first team member!" /> :
              filtered.map(u => (
                <div key={u.id} style={{ display: "grid", gridTemplateColumns: "2fr 1.5fr 1fr 1fr 1fr 1.2fr", padding: "16px 24px", borderBottom: "1px solid #f1f5f9", alignItems: "center", fontSize: 14, transition: "background 0.15s" }} onMouseEnter={e => e.currentTarget.style.background = "#fafbfe"} onMouseLeave={e => e.currentTarget.style.background = "transparent"}>
                  <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                    <div style={{ width: 34, height: 34, borderRadius: 10, background: `linear-gradient(135deg, ${getRoleColor(u.role)}cc, ${getRoleColor(u.role)})`, color: "#fff", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 700, flexShrink: 0 }}>{u.fullName.charAt(0).toUpperCase()}</div>
                    <div><div style={{ fontWeight: 700, color: "#1a1a2e" }}>{u.fullName}</div><div style={{ fontSize: 11, color: "#94a3b8" }}>Created {formatDate(u.createdAt)}</div></div>
                  </div>
                  <span style={{ color: "#475569", fontWeight: 500, fontFamily: "monospace", fontSize: 13 }}>{u.username}</span>
                  <div style={{ display: "flex", alignItems: "center", gap: 4 }}>
                    <span style={{ color: "#475569", fontFamily: "monospace", fontSize: 13 }}>{showPwd[u.id] ? u.password : "â€¢â€¢â€¢â€¢â€¢â€¢"}</span>
                    <button onClick={() => setShowPwd(p => ({ ...p, [u.id]: !p[u.id] }))} style={{ border: "none", background: "none", cursor: "pointer", fontSize: 13, color: "#94a3b8", padding: 2 }}>{showPwd[u.id] ? "ğŸ™ˆ" : "ğŸ‘"}</button>
                  </div>
                  <span style={{ display: "inline-block", padding: "4px 10px", borderRadius: 6, fontSize: 12, fontWeight: 600, textTransform: "capitalize", width: "fit-content", background: getRoleColor(u.role) + "18", color: getRoleColor(u.role) }}>{u.role}</span>
                  <div><button onClick={() => toggleActive(u.id)} style={{ padding: "4px 12px", borderRadius: 20, border: "none", fontSize: 12, fontWeight: 600, cursor: "pointer", fontFamily: "inherit", background: u.active !== false ? "#ecfdf5" : "#fef2f2", color: u.active !== false ? "#059669" : "#dc2626" }}>{u.active !== false ? "Active" : "Inactive"}</button></div>
                  <div style={{ display: "flex", gap: 6, justifyContent: "flex-end" }}>
                    <button onClick={() => { setShowEdit(u.id); setEditForm({ fullName: u.fullName, role: u.role, active: u.active !== false, password: "" }); setError(""); }} style={{ padding: "6px 14px", borderRadius: 8, border: "1px solid #e2e8f0", background: "#fff", color: "#475569", fontSize: 12, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }}>Edit</button>
                    <button onClick={() => { if (confirm(`Delete user "${u.fullName}"?`)) deleteUser(u.id); }} style={{ padding: "6px 14px", borderRadius: 8, border: "1px solid #fecaca", background: "#fff", color: "#dc2626", fontSize: 12, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }}>Delete</button>
                  </div>
                </div>
              ))
            }
          </div>
          <Modal open={showCreate} onClose={() => setShowCreate(false)} title="Create New User" width={480}>
            {error && <div style={{ padding: "10px 14px", borderRadius: 10, background: "#fef2f2", border: "1px solid #fecaca", color: "#dc2626", fontSize: 13, fontWeight: 500, marginBottom: 16 }}>âš  {error}</div>}
            <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
              <div><label style={labelStyle}>Full Name</label><input value={form.fullName} onChange={e => setForm({ ...form, fullName: e.target.value })} placeholder="e.g. Rahul Sharma" style={inputStyle} {...focusHandler()} /></div>
              <div><label style={labelStyle}>Username</label><input value={form.username} onChange={e => setForm({ ...form, username: e.target.value })} placeholder="e.g. rahul.sharma" style={inputStyle} {...focusHandler()} /></div>
              <div><label style={labelStyle}>Password</label><input value={form.password} onChange={e => setForm({ ...form, password: e.target.value })} type="text" placeholder="Min 4 characters" style={inputStyle} {...focusHandler()} /></div>
              <div><label style={labelStyle}>Role</label><RoleSelector value={form.role} onChange={r => setForm({ ...form, role: r })} /></div>
              <div style={{ display: "flex", gap: 10, marginTop: 4 }}>
                <button onClick={() => setShowCreate(false)} style={{ flex: 1, padding: "12px", borderRadius: 10, border: "1.5px solid #e2e8f0", background: "#fff", color: "#64748b", fontSize: 14, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }}>Cancel</button>
                <button onClick={handleCreate} style={{ flex: 1, padding: "12px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #6366f1, #7c3aed)", color: "#fff", fontSize: 14, fontWeight: 700, cursor: "pointer", fontFamily: "inherit" }}>Create User</button>
              </div>
            </div>
          </Modal>
          <Modal open={!!showEdit} onClose={() => setShowEdit(null)} title="Edit User" width={480}>
            {error && <div style={{ padding: "10px 14px", borderRadius: 10, background: "#fef2f2", border: "1px solid #fecaca", color: "#dc2626", fontSize: 13, fontWeight: 500, marginBottom: 16 }}>âš  {error}</div>}
            <div style={{ display: "flex", flexDirection: "column", gap: 16 }}>
              <div><label style={labelStyle}>Full Name</label><input value={editForm.fullName || ""} onChange={e => setEditForm({ ...editForm, fullName: e.target.value })} style={inputStyle} {...focusHandler()} /></div>
              <div><label style={labelStyle}>New Password (leave blank to keep)</label><input value={editForm.password || ""} onChange={e => setEditForm({ ...editForm, password: e.target.value })} type="text" placeholder="Leave blank to keep" style={inputStyle} {...focusHandler()} /></div>
              <div><label style={labelStyle}>Role</label><RoleSelector value={editForm.role} onChange={r => setEditForm({ ...editForm, role: r })} /></div>
              <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                <label style={{ ...labelStyle, margin: 0 }}>Active</label>
                <button onClick={() => setEditForm({ ...editForm, active: !editForm.active })} style={{ width: 44, height: 24, borderRadius: 12, border: "none", cursor: "pointer", position: "relative", transition: "background 0.2s", background: editForm.active ? "#6366f1" : "#e2e8f0" }}><div style={{ width: 18, height: 18, borderRadius: 9, background: "#fff", position: "absolute", top: 3, left: editForm.active ? 23 : 3, transition: "left 0.2s", boxShadow: "0 1px 3px rgba(0,0,0,0.15)" }} /></button>
              </div>
              <div style={{ display: "flex", gap: 10, marginTop: 4 }}>
                <button onClick={() => setShowEdit(null)} style={{ flex: 1, padding: "12px", borderRadius: 10, border: "1.5px solid #e2e8f0", background: "#fff", color: "#64748b", fontSize: 14, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }}>Cancel</button>
                <button onClick={handleEdit} style={{ flex: 1, padding: "12px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #6366f1, #7c3aed)", color: "#fff", fontSize: 14, fontWeight: 700, cursor: "pointer", fontFamily: "inherit" }}>Save Changes</button>
              </div>
            </div>
          </Modal>
        </div>
      );
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â”€â”€â”€ SALES FORM â”€â”€â”€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function SalesForm({ onSubmit, currentUser }) {
      const [form, setForm] = useState({ customerName: "", customerId: "", platform: "", accountType: "", credits: "", rate: "", amount: "", reason: "" });
      const platform = PLATFORMS.find(p => p.id === form.platform);
      const isCredit = platform?.system === "credit";
      const isPostpaid = form.accountType === "postpaid";
      const valid = form.customerName && form.customerId && form.platform && form.accountType && currentUser?.fullName && (isCredit ? (form.credits && form.rate) : form.amount);

      const handleSubmit = () => {
        if (!valid) return;
        const totalAmount = isCredit ? (parseFloat(form.credits) * parseFloat(form.rate)).toFixed(2) : parseFloat(form.amount).toFixed(2);
        onSubmit({
          id: generateId(), ...form, salesPerson: currentUser.fullName, salesUsername: currentUser.username,
          platformName: platform.name, system: platform.system, totalAmount,
          status: isPostpaid ? STATUS.AUTO_APPROVED : STATUS.PENDING_ACCOUNTS,
          createdAt: new Date().toISOString(), invoiceName: "", completedAt: null,
          approvedAt: isPostpaid ? new Date().toISOString() : null, rejectedReason: "",
        });
        setForm({ customerName: "", customerId: "", platform: "", accountType: "", credits: "", rate: "", amount: "", reason: "" });
      };

      return (
        <div style={{ background: "#fff", borderRadius: 16, padding: 32, border: "1px solid #e8ecf1" }}>
          <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 28 }}>
            <div style={{ width: 36, height: 36, borderRadius: 10, background: "linear-gradient(135deg, #6366f1, #8b5cf6)", display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontSize: 16 }}>+</div>
            <h3 style={{ margin: 0, fontSize: 18, fontWeight: 700, color: "#1a1a2e" }}>New Credit Request</h3>
          </div>
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 18 }}>
            <div>
              <label style={labelStyle}>Requested By</label>
              <div style={{ ...inputStyle, background: "#eef2ff", border: "1.5px solid #c7d2fe", color: "#4338ca", fontWeight: 600, display: "flex", alignItems: "center", gap: 8 }}>
                <span style={{ width: 22, height: 22, borderRadius: 6, background: "#6366f1", color: "#fff", display: "inline-flex", alignItems: "center", justifyContent: "center", fontSize: 11, fontWeight: 700, flexShrink: 0 }}>{currentUser?.fullName?.charAt(0)?.toUpperCase()}</span>
                {currentUser?.fullName}
                <span style={{ marginLeft: "auto", fontSize: 11, color: "#818cf8", fontWeight: 500 }}>@{currentUser?.username}</span>
              </div>
            </div>
            <div><label style={labelStyle}>Customer Name</label><input style={inputStyle} placeholder="Customer name" value={form.customerName} onChange={e => setForm({ ...form, customerName: e.target.value })} {...focusHandler()} /></div>
            <div><label style={labelStyle}>Customer / User ID</label><input style={inputStyle} placeholder="e.g. USR-12345" value={form.customerId} onChange={e => setForm({ ...form, customerId: e.target.value })} {...focusHandler()} /></div>
            <div>
              <label style={labelStyle}>Platform</label>
              <select style={{ ...inputStyle, cursor: "pointer", appearance: "none", backgroundImage: "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E\")", backgroundRepeat: "no-repeat", backgroundPosition: "right 14px center" }} value={form.platform} onChange={e => setForm({ ...form, platform: e.target.value, credits: "", rate: "", amount: "" })}>
                <option value="">Select platform</option>
                {PLATFORMS.map(p => <option key={p.id} value={p.id}>{p.name} ({p.system})</option>)}
              </select>
            </div>
            <div>
              <label style={labelStyle}>Account Type</label>
              <div style={{ display: "flex", gap: 10 }}>
                {["prepaid", "postpaid"].map(type => (
                  <button key={type} onClick={() => setForm({ ...form, accountType: type })} style={{ flex: 1, padding: "12px 14px", border: form.accountType === type ? "2px solid #6366f1" : "1.5px solid #e2e8f0", borderRadius: 10, background: form.accountType === type ? "#eef2ff" : "#fafbfc", color: form.accountType === type ? "#4338ca" : "#64748b", cursor: "pointer", fontSize: 13, fontWeight: 600, textTransform: "capitalize", fontFamily: "inherit" }}>{type}</button>
                ))}
              </div>
            </div>
            {platform && isCredit && (<>
              <div><label style={labelStyle}>Credits</label><input style={inputStyle} type="number" placeholder="e.g. 10000" value={form.credits} onChange={e => setForm({ ...form, credits: e.target.value })} {...focusHandler()} /></div>
              <div><label style={labelStyle}>Rate (â‚¹ per credit)</label><input style={inputStyle} type="number" step="0.01" placeholder="e.g. 0.25" value={form.rate} onChange={e => setForm({ ...form, rate: e.target.value })} {...focusHandler()} /></div>
            </>)}
            {platform && !isCredit && (
              <div style={{ gridColumn: "1 / -1" }}><label style={labelStyle}>Amount (â‚¹)</label><input style={inputStyle} type="number" placeholder="e.g. 5000" value={form.amount} onChange={e => setForm({ ...form, amount: e.target.value })} {...focusHandler()} /></div>
            )}
            <div style={{ gridColumn: "1 / -1" }}><label style={labelStyle}>Reason / Notes (Optional)</label><textarea style={{ ...inputStyle, minHeight: 70, resize: "vertical" }} placeholder="Brief reason..." value={form.reason} onChange={e => setForm({ ...form, reason: e.target.value })} {...focusHandler()} /></div>
          </div>
          {isPostpaid && form.accountType && <div style={{ marginTop: 16, padding: "10px 14px", borderRadius: 10, background: "#f0fdf4", border: "1px solid #bbf7d0", fontSize: 13, color: "#166534" }}>âš¡ Postpaid â€” bypasses Accounts, goes directly to Ops.</div>}
          {platform && form.credits && form.rate && isCredit && <div style={{ marginTop: 16, padding: "10px 14px", borderRadius: 10, background: "#eef2ff", border: "1px solid #c7d2fe", fontSize: 13, color: "#3730a3" }}>Total: <strong>â‚¹{(parseFloat(form.credits || 0) * parseFloat(form.rate || 0)).toFixed(2)}</strong> ({form.credits} Ã— â‚¹{form.rate})</div>}
          <button onClick={handleSubmit} disabled={!valid} style={{ marginTop: 24, width: "100%", padding: "14px 24px", borderRadius: 12, border: "none", background: valid ? "linear-gradient(135deg, #6366f1, #7c3aed)" : "#e2e8f0", color: valid ? "#fff" : "#94a3b8", fontSize: 15, fontWeight: 700, cursor: valid ? "pointer" : "not-allowed", fontFamily: "inherit" }}>Submit Request</button>
        </div>
      );
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â”€â”€â”€ REQUEST CARD â”€â”€â”€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function RequestCard({ req, role, onAction }) {
      const [showInvoice, setShowInvoice] = useState(false);
      const [invoice, setInvoice] = useState("");
      const [rejectReason, setRejectReason] = useState("");
      const [showReject, setShowReject] = useState(false);
      const isCredit = req.system === "credit";
      const cb = STATUS_COLORS[req.status]?.border || "#e8ecf1";

      return (<>
        <div style={{ background: "#fff", borderRadius: 14, padding: "22px 26px", border: "1px solid #e8ecf1", borderLeft: `4px solid ${cb}`, transition: "box-shadow 0.2s" }} onMouseEnter={e => e.currentTarget.style.boxShadow = "0 4px 20px rgba(0,0,0,0.06)"} onMouseLeave={e => e.currentTarget.style.boxShadow = "none"}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 14 }}>
            <div>
              <div style={{ fontSize: 11, color: "#94a3b8", fontWeight: 600, letterSpacing: 0.8, marginBottom: 4 }}>{req.id}</div>
              <div style={{ fontSize: 16, fontWeight: 700, color: "#1a1a2e" }}>{req.customerName}</div>
              <div style={{ fontSize: 13, color: "#64748b", marginTop: 2 }}>ID: {req.customerId} â€¢ by <strong>{req.salesPerson}</strong> <span style={{ color: "#94a3b8" }}>(@{req.salesUsername})</span></div>
            </div>
            <Badge status={req.status} />
          </div>
          <div style={{ display: "flex", flexWrap: "wrap", gap: 8, marginBottom: 14 }}>
            <span style={{ padding: "4px 10px", borderRadius: 6, background: "#f1f5f9", fontSize: 12, color: "#475569", fontWeight: 500 }}>{req.platformName}</span>
            <span style={{ padding: "4px 10px", borderRadius: 6, background: req.accountType === "postpaid" ? "#ecfdf5" : "#fef3c7", fontSize: 12, color: req.accountType === "postpaid" ? "#065f46" : "#92400e", fontWeight: 500, textTransform: "capitalize" }}>{req.accountType}</span>
            <span style={{ padding: "4px 10px", borderRadius: 6, background: isCredit ? "#ede9fe" : "#fce7f3", fontSize: 12, color: isCredit ? "#5b21b6" : "#9d174d", fontWeight: 500 }}>{isCredit ? "Credit" : "Wallet"}</span>
          </div>
          <div style={{ display: "grid", gridTemplateColumns: isCredit ? "1fr 1fr 1fr" : "1fr", gap: 12, padding: "12px 0", borderTop: "1px solid #f1f5f9" }}>
            {isCredit ? (<>
              <div><div style={{ fontSize: 11, color: "#94a3b8", fontWeight: 600 }}>CREDITS</div><div style={{ fontSize: 16, fontWeight: 700, color: "#1a1a2e" }}>{Number(req.credits).toLocaleString()}</div></div>
              <div><div style={{ fontSize: 11, color: "#94a3b8", fontWeight: 600 }}>RATE</div><div style={{ fontSize: 16, fontWeight: 700, color: "#1a1a2e" }}>â‚¹{req.rate}</div></div>
              <div><div style={{ fontSize: 11, color: "#94a3b8", fontWeight: 600 }}>TOTAL</div><div style={{ fontSize: 16, fontWeight: 700, color: "#6366f1" }}>â‚¹{Number(req.totalAmount).toLocaleString()}</div></div>
            </>) : (
              <div><div style={{ fontSize: 11, color: "#94a3b8", fontWeight: 600 }}>AMOUNT</div><div style={{ fontSize: 16, fontWeight: 700, color: "#6366f1" }}>â‚¹{Number(req.totalAmount).toLocaleString()}</div></div>
            )}
          </div>
          {req.reason && <div style={{ fontSize: 13, color: "#64748b", marginTop: 8, padding: "8px 12px", background: "#f8fafc", borderRadius: 8, fontStyle: "italic" }}>"{req.reason}"</div>}
          {req.invoiceName && <div style={{ fontSize: 13, color: "#0d9488", marginTop: 8, fontWeight: 600 }}>ğŸ“„ Invoice: {req.invoiceName}</div>}
          {req.rejectedReason && <div style={{ fontSize: 13, color: "#dc2626", marginTop: 8, fontWeight: 500 }}>âŒ Reason: {req.rejectedReason}</div>}
          <div style={{ fontSize: 12, color: "#94a3b8", marginTop: 10 }}>Created: {formatDate(req.createdAt)}{req.approvedBy && <> â€¢ Approved by: {req.approvedBy}</>}{req.completedBy && <> â€¢ Completed by: {req.completedBy}</>}{req.completedAt && <> â€¢ {formatDate(req.completedAt)}</>}</div>
          {role === "accounts" && req.status === STATUS.PENDING_ACCOUNTS && (
            <div style={{ display: "flex", gap: 10, marginTop: 16 }}>
              <button onClick={() => setShowInvoice(true)} style={{ flex: 1, padding: "10px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #10b981, #059669)", color: "#fff", fontSize: 13, fontWeight: 700, cursor: "pointer", fontFamily: "inherit" }}>âœ“ Approve</button>
              <button onClick={() => setShowReject(true)} style={{ flex: 1, padding: "10px", borderRadius: 10, border: "1.5px solid #fca5a5", background: "#fff", color: "#dc2626", fontSize: 13, fontWeight: 700, cursor: "pointer", fontFamily: "inherit" }}>âœ• Reject</button>
            </div>
          )}
          {role === "ops" && (req.status === STATUS.APPROVED || req.status === STATUS.AUTO_APPROVED) && (
            <button onClick={() => onAction(req.id, "complete")} style={{ marginTop: 16, width: "100%", padding: "10px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #3b82f6, #2563eb)", color: "#fff", fontSize: 13, fontWeight: 700, cursor: "pointer", fontFamily: "inherit" }}>âœ“ Mark as Completed</button>
          )}
        </div>
        <Modal open={showInvoice} onClose={() => setShowInvoice(false)} title="Approve & Add Invoice">
          <label style={labelStyle}>Invoice Name / Number</label>
          <input value={invoice} onChange={e => setInvoice(e.target.value)} placeholder="e.g. INV-2025-001" style={inputStyle} {...focusHandler("#10b981")} />
          <div style={{ display: "flex", gap: 10, marginTop: 20 }}>
            <button onClick={() => setShowInvoice(false)} style={{ flex: 1, padding: "10px", borderRadius: 10, border: "1.5px solid #e2e8f0", background: "#fff", color: "#64748b", fontSize: 13, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }}>Cancel</button>
            <button disabled={!invoice.trim()} onClick={() => { onAction(req.id, "approve", invoice.trim()); setShowInvoice(false); setInvoice(""); }} style={{ flex: 1, padding: "10px", borderRadius: 10, border: "none", background: invoice.trim() ? "linear-gradient(135deg, #10b981, #059669)" : "#e2e8f0", color: invoice.trim() ? "#fff" : "#94a3b8", fontSize: 13, fontWeight: 700, cursor: invoice.trim() ? "pointer" : "not-allowed", fontFamily: "inherit" }}>Approve</button>
          </div>
        </Modal>
        <Modal open={showReject} onClose={() => setShowReject(false)} title="Reject Request">
          <label style={labelStyle}>Reason for rejection</label>
          <textarea value={rejectReason} onChange={e => setRejectReason(e.target.value)} placeholder="Provide a reason..." style={{ ...inputStyle, minHeight: 80, resize: "vertical" }} />
          <div style={{ display: "flex", gap: 10, marginTop: 20 }}>
            <button onClick={() => setShowReject(false)} style={{ flex: 1, padding: "10px", borderRadius: 10, border: "1.5px solid #e2e8f0", background: "#fff", color: "#64748b", fontSize: 13, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }}>Cancel</button>
            <button disabled={!rejectReason.trim()} onClick={() => { onAction(req.id, "reject", rejectReason.trim()); setShowReject(false); setRejectReason(""); }} style={{ flex: 1, padding: "10px", borderRadius: 10, border: "none", background: rejectReason.trim() ? "#ef4444" : "#e2e8f0", color: rejectReason.trim() ? "#fff" : "#94a3b8", fontSize: 13, fontWeight: 700, cursor: rejectReason.trim() ? "pointer" : "not-allowed", fontFamily: "inherit" }}>Reject</button>
          </div>
        </Modal>
      </>);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â”€â”€â”€ MAIN APP â”€â”€â”€
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function App() {
      const [requests, setRequests, reqLoaded] = useFirebase("portal/requests", []);
      const [users, setUsers, usersLoaded] = useFirebase("portal/users", []);
      const [session, setSession] = useLocal("credit_portal_session_v6", null);
      const [filter, setFilter] = useState("all");
      const [toast, setToast] = useState(null);

      const loaded = reqLoaded && usersLoaded;
      const user = session;
      const role = user?.role;

      const showToast = (msg, type = "success") => { setToast({ msg, type }); setTimeout(() => setToast(null), 3000); };
      const handleLogin = (found) => { setSession(found); showToast(`Welcome back, ${found.fullName}!`); };
      const handleLogout = () => { setSession(null); setFilter("all"); };
      const handleNewRequest = (req) => { setRequests([req, ...requests]); showToast(req.status === STATUS.AUTO_APPROVED ? `${req.id} auto-approved (Postpaid)!` : `${req.id} submitted!`); };

      const handleAction = (id, action, data) => {
        const updated = requests.map(r => {
          if (r.id !== id) return r;
          if (action === "approve") return { ...r, status: STATUS.APPROVED, invoiceName: data, approvedAt: new Date().toISOString(), approvedBy: user?.fullName };
          if (action === "reject") return { ...r, status: STATUS.REJECTED, rejectedReason: data, rejectedBy: user?.fullName };
          if (action === "complete") return { ...r, status: STATUS.COMPLETED, completedAt: new Date().toISOString(), completedBy: user?.fullName };
          return r;
        });
        setRequests(updated);
        showToast(`Request ${id} ${action === "approve" ? "approved" : action === "reject" ? "rejected" : "completed"}!`, action === "reject" ? "error" : "success");
      };

      const getFiltered = () => {
        let items = requests;
        if (role === "sales") items = items.filter(r => r.salesUsername === user?.username);
        if (role === "accounts") items = items.filter(r => r.accountType !== "postpaid");
        if (role === "ops") items = items.filter(r => [STATUS.APPROVED, STATUS.AUTO_APPROVED, STATUS.COMPLETED].includes(r.status));
        if (filter === "all") return items;
        const map = { pending: [STATUS.PENDING_ACCOUNTS], approved: [STATUS.APPROVED, STATUS.AUTO_APPROVED], rejected: [STATUS.REJECTED], completed: [STATUS.COMPLETED], actionable: role === "accounts" ? [STATUS.PENDING_ACCOUNTS] : [STATUS.APPROVED, STATUS.AUTO_APPROVED] };
        return items.filter(r => (map[filter] || []).includes(r.status));
      };

      const fil = getFiltered();
      const myReqs = role === "sales" ? requests.filter(r => r.salesUsername === user?.username) : requests;
      const counts = {
        all: role === "accounts" ? requests.filter(r => r.accountType !== "postpaid").length : role === "ops" ? requests.filter(r => [STATUS.APPROVED, STATUS.AUTO_APPROVED, STATUS.COMPLETED].includes(r.status)).length : role === "sales" ? myReqs.length : requests.length,
        pending: (role === "sales" ? myReqs : requests).filter(r => r.status === STATUS.PENDING_ACCOUNTS).length,
        approved: (role === "sales" ? myReqs : requests).filter(r => [STATUS.APPROVED, STATUS.AUTO_APPROVED].includes(r.status)).length,
        rejected: (role === "sales" ? myReqs : requests).filter(r => r.status === STATUS.REJECTED).length,
        completed: (role === "sales" ? myReqs : requests).filter(r => r.status === STATUS.COMPLETED).length,
      };

      const fOpts = {
        sales: [{ value: "all", label: "All", count: counts.all }, { value: "pending", label: "Pending", count: counts.pending }, { value: "approved", label: "Approved", count: counts.approved }, { value: "rejected", label: "Rejected", count: counts.rejected }, { value: "completed", label: "Completed", count: counts.completed }],
        accounts: [{ value: "all", label: "All", count: counts.all }, { value: "actionable", label: "Needs Action", count: counts.pending }, { value: "approved", label: "Approved", count: counts.approved }, { value: "rejected", label: "Rejected", count: counts.rejected }],
        ops: [{ value: "all", label: "All", count: counts.all }, { value: "actionable", label: "Needs Action", count: counts.approved }, { value: "completed", label: "Completed", count: counts.completed }],
      };

      if (!loaded) return (
        <div style={{ display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", minHeight: "100vh", background: "#f4f6fa", gap: 12 }}>
          <div style={{ width: 40, height: 40, borderRadius: 10, background: "linear-gradient(135deg, #6366f1, #7c3aed)", display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontSize: 18, fontWeight: 800 }}>T</div>
          <div style={{ color: "#94a3b8", fontSize: 14 }}>Connecting to database...</div>
        </div>
      );

      if (!user) return <LoginScreen users={users} onLogin={handleLogin} />;
      const ri = getRoleInfo(role);

      return (
        <div style={{ minHeight: "100vh", background: "#f4f6fa", fontFamily: "'DM Sans', 'Segoe UI', sans-serif" }}>
          {toast && <div style={{ position: "fixed", top: 20, left: "50%", transform: "translateX(-50%)", zIndex: 2000, padding: "12px 24px", borderRadius: 12, fontSize: 14, fontWeight: 600, fontFamily: "inherit", background: toast.type === "error" ? "#fef2f2" : "#f0fdf4", color: toast.type === "error" ? "#dc2626" : "#166534", border: `1px solid ${toast.type === "error" ? "#fecaca" : "#bbf7d0"}`, boxShadow: "0 8px 30px rgba(0,0,0,0.1)", animation: "toastIn 0.3s ease" }}>{toast.msg}</div>}

          {/* Header */}
          <div style={{ background: "#fff", borderBottom: "1px solid #e8ecf1", padding: "0 32px", position: "sticky", top: 0, zIndex: 100 }}>
            <div style={{ maxWidth: 1200, margin: "0 auto", display: "flex", alignItems: "center", justifyContent: "space-between", height: 64 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                <div style={{ width: 32, height: 32, borderRadius: 8, background: "linear-gradient(135deg, #6366f1, #7c3aed)", display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontSize: 14, fontWeight: 800 }}>T</div>
                <span style={{ fontSize: 17, fontWeight: 800, color: "#1a1a2e", letterSpacing: -0.3 }}>Telinfy Credit Portal</span>
                <span style={{ padding: "4px 12px", borderRadius: 6, background: ri.color + "15", color: ri.color, fontSize: 12, fontWeight: 700, marginLeft: 4 }}>{ri.icon} {ri.label}</span>
                <ConnectionDot />
              </div>
              <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
                <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                  <div style={{ width: 34, height: 34, borderRadius: 10, background: `linear-gradient(135deg, ${ri.color}cc, ${ri.color})`, display: "flex", alignItems: "center", justifyContent: "center", color: "#fff", fontSize: 14, fontWeight: 700 }}>{user.fullName.charAt(0).toUpperCase()}</div>
                  <div style={{ lineHeight: 1.2 }}><div style={{ fontSize: 13, fontWeight: 700, color: "#1a1a2e" }}>{user.fullName}</div><div style={{ fontSize: 11, color: "#94a3b8" }}>@{user.username}</div></div>
                </div>
                <button onClick={handleLogout} style={{ padding: "7px 14px", borderRadius: 8, border: "1px solid #e2e8f0", background: "#fff", color: "#64748b", fontSize: 12, fontWeight: 600, cursor: "pointer", fontFamily: "inherit" }} onMouseEnter={e => { e.currentTarget.style.borderColor = "#fca5a5"; e.currentTarget.style.color = "#ef4444"; }} onMouseLeave={e => { e.currentTarget.style.borderColor = "#e2e8f0"; e.currentTarget.style.color = "#64748b"; }}>Sign out</button>
              </div>
            </div>
          </div>

          <div style={{ maxWidth: 1200, margin: "0 auto", padding: "28px 32px" }}>
            <SetupBanner />

            {role === "admin" && <AdminPanel users={users} onSaveUsers={setUsers} />}

            {role === "sales" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 14, marginBottom: 28 }}>
                <StatCard label="My Requests" value={myReqs.length} color="#6366f1" icon="ğŸ“Š" />
                <StatCard label="Pending" value={counts.pending} color="#f59e0b" icon="â³" />
                <StatCard label="Approved" value={counts.approved} color="#10b981" icon="âœ“" />
                <StatCard label="Completed" value={counts.completed} color="#3b82f6" icon="ğŸ¯" />
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 28, alignItems: "start" }}>
                <SalesForm onSubmit={handleNewRequest} currentUser={user} />
                <div>
                  <h3 style={{ margin: "0 0 16px", fontSize: 18, fontWeight: 700, color: "#1a1a2e" }}>My Requests</h3>
                  <FilterTabs filters={fOpts.sales} active={filter} onChange={setFilter} />
                  <div style={{ display: "flex", flexDirection: "column", gap: 12, maxHeight: 700, overflowY: "auto", paddingRight: 4 }}>
                    {fil.length === 0 ? <EmptyState icon="ğŸ“­" message="No requests yet!" /> : fil.map(r => <RequestCard key={r.id} req={r} role="sales" onAction={handleAction} />)}
                  </div>
                </div>
              </div>
            </>)}

            {role === "accounts" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 14, marginBottom: 28 }}>
                <StatCard label="Total" value={requests.length} color="#6366f1" icon="ğŸ“Š" />
                <StatCard label="Pending Review" value={counts.pending} color="#f59e0b" icon="â³" />
                <StatCard label="Approved" value={counts.approved} color="#10b981" icon="âœ“" />
                <StatCard label="Completed" value={counts.completed} color="#3b82f6" icon="ğŸ¯" />
              </div>
              <h3 style={{ margin: "0 0 16px", fontSize: 18, fontWeight: 700, color: "#1a1a2e" }}>Accounts Review <span style={{ fontSize: 13, fontWeight: 400, color: "#94a3b8" }}>Prepaid only â€” Postpaid auto-approved</span></h3>
              <FilterTabs filters={fOpts.accounts} active={filter} onChange={setFilter} />
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
                {fil.length === 0 ? <div style={{ gridColumn: "1 / -1" }}><EmptyState icon="âœ…" message="No requests pending." /></div> : fil.map(r => <RequestCard key={r.id} req={r} role="accounts" onAction={handleAction} />)}
              </div>
            </>)}

            {role === "ops" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 14, marginBottom: 28 }}>
                <StatCard label="Total" value={requests.length} color="#6366f1" icon="ğŸ“Š" />
                <StatCard label="Pending" value={counts.pending} color="#f59e0b" icon="â³" />
                <StatCard label="In Queue" value={counts.approved} color="#10b981" icon="âœ“" />
                <StatCard label="Completed" value={counts.completed} color="#3b82f6" icon="ğŸ¯" />
              </div>
              <h3 style={{ margin: "0 0 16px", fontSize: 18, fontWeight: 700, color: "#1a1a2e" }}>Operations Queue <span style={{ fontSize: 13, fontWeight: 400, color: "#94a3b8" }}>Approved & Auto-Approved</span></h3>
              <FilterTabs filters={fOpts.ops} active={filter} onChange={setFilter} />
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 14 }}>
                {fil.length === 0 ? <div style={{ gridColumn: "1 / -1" }}><EmptyState icon="ğŸ¯" message="No requests in queue." /></div> : fil.map(r => <RequestCard key={r.id} req={r} role="ops" onAction={handleAction} />)}
              </div>
            </>)}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
